#include "DxLib.h"
#include "Map.h"
#include "../game.h"
#include "../DrawFunctions.h"

Map::Map():
	map_(),
	mappos_(),
	drawindexX_(0),
	drawindexY_(0)
{
	groundH_ = my::MyLoadGraph(L"Data/maptip/jimen1.png");
	startmappos_.x = (Game::kScreenWidth / 2) - ((32 * 32) / 2);
	startmappos_.y = (Game::kScreenHeight / 2) - ((32 * 16) / 2);

	SetMapData();

}

Map::~Map()
{
	DeleteGraph(groundH_);
}

void Map::Init()
{
}

void Map::End()
{
}

void Map::Update(Vec2 playerpos)
{
	mappos_.x = playerpos.x;
	mappos_.y = playerpos.y;

	drawindexX_ = (static_cast<int>(mappos_.x) - ((32 * 32) / 2)) / (32 * 32);
	drawindexY_ = (static_cast<int>(mappos_.y) - ((32 * 16) / 2)) / (32 * 16);
}

void Map::Draw()
{
	for (int y = drawindexY_ - 1; y <= drawindexY_ + 2; y++) {
		for (int x = drawindexX_ - 1; x <= drawindexX_ + 2; x++) {
			for (int i = 0; i < map_[0][0].height; i++) {
				for (int j = 0; j < map_[0][0].width; j++) {
					if (map_[0][0].data[i][j] == 1) {
						DrawGraph((x * (32 * 32)) + startmappos_.x + (32 * j) - mappos_.x, (y * (32 * 16)) + startmappos_.y + (32 * i) - mappos_.y, groundH_, true);
					}
				}
			}
		}
	}
	//DrawFormatString(200, 200, 0xffffff, L"%f,%f", mappos_.x, mappos_.y, true);

}

void Map::SetMapData()
{
	for (int i = 0; i < map_numY; i++) {
		for (int j = 0; j < map_numX; j++) {
			map_[i][j] = {
				16,
				32,
				{
					{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
					{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
					{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
					{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
					{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
					{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
					{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
					{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
					{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
					{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
					{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
					{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
					{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
					{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
					{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
					{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
				}
			};
		}
	}
}
